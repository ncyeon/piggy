<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>목표 페이지</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="https://unpkg.com/vue@3"></script>

    <style>
      .progress {
        height: 20px;
        background-color: #eee;
        border-radius: 10px;
        overflow: hidden;
      }

      .progress-bar {
        transition: width 0.6s ease-in-out;
      }

      .pig-img {
        width: 250px;
        margin-top: 20px;
        transition: transform 0.3s ease-in-out;
      }

      .pig-img:hover {
        transform: scale(1.1);
      }

      .goal-box {
        max-width: 400px;
        margin: 50px auto;
        padding: 30px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        text-align: center;
      }
    </style>
  </head>

  <body>
    <div id="app">
      <div class="goal-box">
        <h2><i class="fa-solid fa-piggy-bank"></i> 저축 목표</h2>
        <br />
        <div class="mb-3 fw-bold">
          목표 금액: {{ goalAmount.toLocaleString() }}원
        </div>
        <div class="progress mb-3">
          <div
            class="progress-bar bg-success"
            role="progressbar"
            :style="{ width: '100%' }"
            aria-valuenow="100"
            aria-valuemin="0"
            aria-valuemax="100"
          ></div>
        </div>

        <div class="mb-2 fw-bold">
          현재 금액: {{ currentAmount.toLocaleString() }}원
        </div>
        <div class="progress mb-3">
          <div
            class="progress-bar"
            role="progressbar"
            :style="{ width: animatedPercentage + '%', backgroundColor: '#42a5f5' }"
            :aria-valuenow="animatedPercentage"
            aria-valuemin="0"
            aria-valuemax="100"
          ></div>
        </div>

        <div
          class="h4"
          style="font-weight: bold; font-family: 'Pretendard', sans-serif"
        >
          {{ Math.floor(animatedPercentage) }}%
        </div>
        <img :src="pigImage" alt="Piggy" class="pig-img" />
      </div>
    </div>

    <script>
      const { createApp, ref, reactive, computed, onMounted } = Vue;

      createApp({
        setup() {
          const budget = ref([]);
          const currentAmount = ref(0);
          const goalAmount = ref(100000);
          const animatedPercentage = ref(0);

          const percentage = computed(() => {
            return Math.min(
              (currentAmount.value / goalAmount.value) * 100,
              100
            );
          });

          const pigImage = computed(() => {
            const percent = animatedPercentage.value;
            if (percent < 25) return 'src/assets/images/poor_pig.png';
            if (percent < 50) return 'src/assets/images/pig.svg';
            if (percent < 75) return 'src/assets/images/over_goal_pig.png';
            return 'src/assets/images/rich_pig.png';
          });

          const calculateSavings = () => {
            const savings = budget.value
              .filter(
                (item) => item.type === 'expense' && item.category === '저축'
              )
              .reduce((sum, item) => sum + item.amount, 0);
            currentAmount.value = savings;
          };

          const animatePercentage = () => {
            const target = percentage.value;
            animatedPercentage.value = 0;

            const step = target / 10;
            const interval = setInterval(() => {
              if (animatedPercentage.value < target) {
                animatedPercentage.value = Math.min(
                  animatedPercentage.value + step,
                  target
                );
              } else {
                clearInterval(interval);
              }
            }, 16);
          };

          const fetchData = async () => {
            try {
              const response = await fetch('mydata.json');
              const data = await response.json();
              budget.value = data.budget;
              goalAmount.value = data.goals?.[0]?.amount || 100000;
              calculateSavings();
              animatePercentage();
            } catch (error) {
              console.error('데이터 불러오기 실패:', error);
            }
          };

          onMounted(() => {
            fetchData();
          });

          return {
            budget,
            currentAmount,
            goalAmount,
            animatedPercentage,
            percentage,
            pigImage,
          };
        },
      }).mount('#app');
    </script>
  </body>
</html>
